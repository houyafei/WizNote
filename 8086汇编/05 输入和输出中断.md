**一 输入和输出的基本概念**

  每种输入输出设备都要通过一个硬件接口或控制器和CPU相连。从程序设计的角度看，接口由一组寄存器组成，是完成输入输出的桥梁。程序利用I/O指令，存取接口上的寄存器，

获得外部设备的状态信息，控制外部设备的动作，从而实现输入输出。

  一般来说，输入输出是站在处理器上而言的，输入指输入到处理器，输出使指从处理器输出。

**1 I/O端口地址和I/O指令**

**1）I/O端口地址**

  在X86处理器中，**I/O端口地址和存储单元的地址是各自独立的**，分占两个不同的地址空间。8086提供的I/O端口地址空间达64K，因而可接**64K个8位端口****或****32K个16位端口**。

但实际上，PC一般只使用**0~3FFH**之间的I/O端口地址，只占很小的一部分。

**2）I/O指令**

  由于I/O端口地址和内存单元式独立的，因此要专门的I/O指令来存取端口上的寄存器，也就是说要用**专门的I/O指令进行输入输出。**

**a.输入指令(从一个端口读取一个字节或一个字,传到AL(字节)或AX(字))。**

 **IN   累加器(AL,AX),****端口地址**

| IN  AL,PORT(AL<-PORT)IN  AX,PORT(AX<-PORT+1:PORT) | 直接方式:端口地址PORT是一个8位的立即数，                   |
| ------------------------------------------------- | ---------------------------------------------------------- |
| IN  AL,DX(AL<-(DX))IN  AX,DX(AX<-(DX+1:DX))       | 间接方式:**当端口地址超过255时，只能采用DX间接端口寻址。** |

**b.输出指令(类似上)**

 **OUT**   **端口地址****,累加器(AL或AX)**

| 位移 | 用途          | 位移  | 用途                                        |
| ---- | ------------- | ----- | ------------------------------------------- |
| 0    | 秒            | 10    | 软驱动器类型                                |
| 1    | 报警秒        | 11    | 保留                                        |
| 2    | 分            | 12    | 硬盘驱动器类型                              |
| 3    | 报警分        | 13    | 保留                                        |
| 4    | 时            | 14    | 设备标志                                    |
| 5    | 报警时        | 15    | 常规RAM容量低字节                           |
| 6    | 星期          | 16    | 常规RAM容量高字节                           |
| 7    | 日            | 17    | 扩展RAM容量低字节                           |
| 8    | 月            | 18    | 扩展RAM容量高字节                           |
| 9    | 年            | 19~1A | 硬驱类型扩展字节                            |
| A~D  | 状态寄存器A~D | 1B~2D | 保留                                        |
| E    | 诊断状态      | 2E~2F | 配置信息字节累加器(10H~2DH端口的字节数累加) |
| F    | 停止状态      | 30~3F | 其他(含世纪信息)                            |

注意：在对同一设备或端口相继发送I/O指令时，为确保I/O设备或端口有足够的电路恢复时间，一般在I/O指令间加"jmp $+2"用于延时。

**2 数据传送方式**

**1）CPU与外设之间交换的信息**

  CPU与外设之间交换的信息包括**数据**、**控制**和**状态信息**。尽管这三种信息具有不同性质，但它们都通过IN和OUT指令在数据总线上进行传递，所以采用分配不同端口的方法将它们加以区分。

  a.**数据是**CPU和外设真正要交换的信息

  b.**控制信息**输出到I/O接口，告诉接口和设备要做什么工作

  c.从接口输入的**状态信息**表示I/O设备的当前状态。在输入数据时，通常要先取得表示设备是否已经准备好的状态信息；在输出数据前，要取得表示设备是否忙的状态信息。

**2）数据传送方式**

**a.无条件传送方式**

不需要考虑外设状态，直接使用**IN**和**OUT**指令实现数据传送。

**b.查询方式**

查询传送方式适用于CPU与外设不同步的情况。要输入输出时，对外设进行询问，知道外设有没有准备好。

**c.中断方式**

当外设准备好时，外设向CPU发出中断请求，CPU转入中断处理程序，完成输入输出工作。

**d.直接存储器传送(DMA)方式**

即高速设备与内存储器直接交换数据，这种方式传送数据时成组进行的。

**3 存取RT/CMOS RAM(略)**

IBM PC/AT及其兼容机上均安装了一个RT/COMS RAM芯片，系统分配了70H~7FH地址给它，通过IN/OUT指令可对其进行存取。

**二 查询方式传送数据**

1 查询传送方式

  查询方式的基本思想是由CPU主动地通过输入输出指令查询制定的外部设备的当前状态，若设备就绪，则立即与设备进行数据交换，否则循环查询。

在实际应用中，为了防止设备因某种原因发生故障而无法就绪或空闲，从而导致CP在无限循环之中，通常都设计一个等待超时值，其值随设备而定。

![img](file:///C:/Users/chen/Documents/My Knowledge/temp/46b412c8-84c6-47de-a648-2ef5ed744df8/128/index_files/c88c3ea694ffa3713243846a7344d254.png)

查询方式的优点：软硬件实现比较简单；当同时查询多个外设时，可以由程序安排查询的先后次序。

缺点：浪费CPU原本可执行大量指令的时间。

**2 读实时钟**

**3 查询方式打印输出**

**三 中断**

**1 中断和中断传送方式**

**1）中断和中断源**

  **中断**是一种使CPU挂起正在执行的程序而转去处理特殊事件的操作。这些引起中断的事件称为**中断源**。

**2）中断传送方式**

  CPU挂起当前正在执行的程序，转去执行输入或输出操作，在完成输入或输出操作后，返回原程序继续执行。

  \- 优点：避免因反复查询外部设备的状态而浪费时间

  \- 缺点：每中断一次，只传输一次数据，数据传送的效率并不高，所以，中断一般用于低速外设

**2 中断向量表**

1）中断向量表

  IBM PC系列及其兼容机共能支持256种类型的中断，**系统给每一种中断都安排一个中断类型号(简称中断号)，中断类型号依次为0~FFH**。

  每种类型的中断都有相应的中断处理程序来处理，为了使系统在相应中断后，CPU能快速地转入对应的中断处理程序，系统用一张表保存这些中断处理程序的入口地址，该表称为**中断向量表**，n号中断向量就保存处理中断类型的为n的中断处理程序的入口地址。

  每个中断向量占用4字节，低位字节保存偏移，高位字节保存段值。

2）中断向量号的分配

  在系统中，某个中断类型号分配给哪个中断，即某个向量含有哪个中断处理程序的入口地址有一些规定和约定，应用程序不能违反规定。

  在IBM PC系列及其兼容机，除保留给用户使用的60H~68H和F1H~FFH中断向量号外，可以认为其他中断向量号已被分配。

3 中断响应过程

4 外部中断

5 内部中断

6 中断优先级和中断嵌套

7 中断处理程序的设计

**四 基本输入输出系统BIOS**