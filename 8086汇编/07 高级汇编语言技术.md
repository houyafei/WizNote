# 一 结果和记录

## 1 结构

### 1）结构类型的说明

用伪指令STRUC和ENDS把一系列数据定义语句概括起来就说明了一个结果类型。例如：

 

```
PERSON   STRUC
   ID    DW   ？ ;一个字段(字段名为ID)
   SCORE DB   0
   PNAME DB   40 dup(0)
PERSON   ENDS
```

组成结构的变量称为结构的字段，相应的变量名称称为字段名。

一个结构可以含有任意数目的字段，字段也可以没有字段名。

结构中字段名代表了从结构的开始到相应字段的偏移。

在说明结构类型时，可以给字段赋初值，也可以不赋予初值。

在说明结构类型时，结构名必须是唯一的，各字段名也应该是唯一的  

### 2）结构变量的定义

在说明了结构类型后，就可定义相应的结构变量。结构变量定义的一般格式如下：

**[变量名]  结构名  < [字段值表] >****例如：Tom PERSON <1,0,>****STUENTS PERSON 255 DUP(<>)**

**注意：**对宏汇编程序MASM而言，如果某个字段有多个值，那么在定义结构变量时，就不能给该字段重赋初值。

### 3）结构变量及其字段的访问

通过结构变量名可直接存取结构变量。若要存取结构变量中的某一字段，则可采用如下形式：

结构变量名.结构字段名 // 寻址方式是直接寻址

另一种存取结构变量的方法是把结构变量地址的偏移先存入某个基址或变址寄存器，然后[寄存器名]代替结构变量名。例如:

mov bx,offset TOMmov al,[bx].MONTH  // 相对基址寻址或变址寻址

## 2 记录

记录类型为按二进制位存储数据或信息提供了方便。

### 1）记录类型的说明

记录名   RECORD   字段[,字段...]记录名标识说明记录类型：字段表示构成字段的字段的名字、宽度和缺省初值。如下：**字段名：宽度[=表达式]**字段名是记录中字段的名字，宽度表示相应的字段所占的位数，宽度必须是常数，宽度最大为16位。 例如：  ABCD   RECORD   AA:5=12,BB:3=6,CC:4=3注意：如果字段总宽度不正好是8位或16位，那么向右对齐，记录高位端为0.

### 2）记录变量的定义

**[变量名]   记录名   <[字段值表]>**

### 3）记录专用操作符

操作符**WIDTH**和**MASK**仅与记录一起使用，得到已说明记录的不同方面的常数值。

a.操作符WIDTH(返回记录或记录中字段以位为单位的宽度)

WIDTH   记录名WIDTH   记录字段名

b.操作符MASK()

c.记录字段

### 4）记录及其字段的访问

# 二 宏

**宏**是**宏汇编语言**的主要特征之一。在汇编语言源程序中若某程序片段需要多次使用，为了避免重复书写，那么可把它定义为一条**宏指令**。

在写源程序时，程序员用宏指令来表示程序片段；在汇编时，汇编使用对应的程序片段代替宏指令。

**1 宏指令的定义和使用**

宏指令在使用之前要先定义。一般格式如下：

宏指令名  MACRO   [形式参数表]      ...       ENDM 例如：GetCh  MACRO  MOV AH,1  INT  21H       ENDM

使用：

宏指令名 [实参数表]

**2 宏指令的用途**

1）缩短源代码

2）扩展指令集(例如PUSHAD和POPAD)

3）改变某些指令助记符的意义（宏指令名可以与指令助记符或伪操作名同名，在这种情况下，宏指令优先级最高，而同名的指令或伪操作就失效了）

**3 宏指令中参数的使用**

**1)****宏指令的参数很灵活**(可以是常数，寄存器和存储单元，还可以是表达式,甚至是操作码)

例如：

 

```
; 定义
SHLN    MACRO REG,NUM
    PUSH    CX
    MOV    CL,NUM
    SHL    REG,CL
    POP    CX
        ENDM
        
; 使用
SHLN BL,5
SHLN SI,9
SHLN AX,CL
MANDM   MACRO OPR,X,Y
    mov AX,X
    OPR AX,Y
    MOV X,AX
        ENDM
; 使用
MANDM MOV [BX],[SI]
```

2）宏调用参数个数可以与定义时不一致

若实参个数多于形参个数，那么多余的实参则被忽略；若实参的个数少于形参个数，那么多余的形参用“空”代替。

**4 特殊的宏运算符**

为了方便宏的定义和使调用，汇编程序还支持如下表的特殊运算符。他们适用于宏的定义和调用中，还适用于重复块。

| **运算符** | **使用格式** | **定义**                                                 |
| ---------- | ------------ | -------------------------------------------------------- |
| &          | &参数        | 强迫替换运算符                                           |
| <>         | <字符串>     | 字符串原样传递运算符（把括号内容视为一个整体）           |
| ！         | ！字符       | 文字字符运算符（类似转义字符，保证原有的&<>%等保持原意） |
| %          | %表达式      | 表达式运算符（把表达式的结果计算后再进行替换）           |
| ;;         | ;;注释       | 宏注释（宏扩展时该注释不出现）                           |

**5 与宏有关的伪指令**

1）局部变量说明伪指令**LOCAL**

如果一个宏中带有标号且被多次使用，汇编时将出现标号重复定义错误。为此，汇编程序提供伪指令LOCAL，说明宏的局部标号。

 

```
HTOASC  MACRO
    LOCAL  ISDECM   ; 这里使用LOCAL说明
    AND    AL,0FH
    CMP    AL,9
    JBE    ISDECM
    ADD    AL,7
ISDECM:
    ADD    AL,30H
        ENDM
```

2）清除宏定义的伪指令**PURGE，**一般格式如下：

**PURGE  宏表名**

3）中止宏扩展的伪指令**EXITM****，**一般格式如下：

**EXITM**

**6 宏定义的嵌套**

1）宏定义体中调用宏

2）宏定义体中定义宏指令

# 三 重复汇编

伪指令**REPT**，**IRP**，**IRPC**定义的三种重复块，他们之间的不同点在于如何规定重复的次数。

**1 伪指令REPT**

REPT用于创建重复块，重复次数由一数值表达式给定。

 

```
REPT    表达式
    ...
    需要重复的语句组
    ...
    ENDM
```

**2 伪指令IRP**

**IRP**用于创建重复块，重复次数和每次重复时使用的实参由实参数列表决定。一般格式如下：

 

```
IRP 形式参数,<实参1,实参2,...,实参n>
    需要重复的语句
    ENDM
```

**3 伪指令IRPC**

IRPC和IRP相似，但实参数列表是一个字符串，一般格式如下：

 

```
IRPC    形式参数,字符串
    需要重复的语句
    ENDM
```

**四 条件汇编**

**1 条件汇编伪指令**

条件汇编语句的一般格式如下：

 

```
IFxxxx    条件表达式
    语句组1
[ELSE
    语句组2]
ENDIF
```

IFxxxx时条件伪指令助记符的一般形式，其中xxxx表示构成条件伪指令助记符的其他字符，完整的条件伪指令助记符如下：

  **IF   IFE   IFDEF   IFNDEF   IF1   IF2
**

  **IFB   IFNB   IFIDN   IFDIF**

**2 条件汇编与宏结合（略）**

# 五 模块化程序设计技术

**1 源程序的结合** 

存放在若干文件中的源程序的结合时利用伪指令**INCLUDE**完成的。他的一般格式如下：

 

```
INCLUDE    文件名
INCLUDE    WINDOWS.inc
```

**2 宏库的使用**